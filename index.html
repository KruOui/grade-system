<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Sarabun', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;


// ‚îÄ‚îÄ Constants ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SUBJECTS_BASE = ["‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå","‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì","‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ"];
const LEVELS = ["‡∏°.1","‡∏°.2","‡∏°.3"];
const ALL_SUBJECTS = SUBJECTS_BASE.flatMap(s => LEVELS.map(l => `${s} ${l}`));
const DEFAULT_PIN = "1234";
const CURRENT_YEAR = "2568";
const CURRENT_TERM = "1";

function calcGrade(total) {
  if (total === "" || total === null || isNaN(total)) return null;
  const t = Number(total);
  if (t < 50)  return "0";
  if (t <= 55) return "1";
  if (t <= 59) return "1.5";
  if (t <= 64) return "2";
  if (t <= 69) return "2.5";
  if (t <= 74) return "3";
  if (t <= 79) return "3.5";
  return "4";
}

function gradeColor(grade) {
  if (!grade || grade === "0") return { bg: "#fef2f2", text: "#dc2626", border: "#fca5a5" };
  if (grade === "1" || grade === "1.5") return { bg: "#fff7ed", text: "#ea580c", border: "#fdba74" };
  if (grade === "2" || grade === "2.5") return { bg: "#fefce8", text: "#ca8a04", border: "#fde047" };
  if (grade === "3") return { bg: "#f0fdf4", text: "#16a34a", border: "#86efac" };
  if (grade === "3.5") return { bg: "#ecfdf5", text: "#059669", border: "#6ee7b7" };
  return { bg: "#eff6ff", text: "#1d4ed8", border: "#93c5fd" };
}

// ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
function scoreStatus(sc) {
  const noCollect = sc.collect === "" || sc.collect === null || sc.collect === undefined || String(sc.collect) === "";
  const noExam    = sc.exam    === "" || sc.exam    === null || sc.exam    === undefined || String(sc.exam)    === "";
  const zeroCollect = Number(sc.collect) === 0 && !noCollect;
  const zeroExam    = Number(sc.exam)    === 0 && !noExam;
  if (noCollect && noExam) return { label:"‡∏£‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö", color:"#6366f1", bg:"#eef2ff", border:"#c7d2fe" };
  if (noCollect || (zeroCollect && noExam)) return { label:"‡∏£‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö", color:"#d97706", bg:"#fffbeb", border:"#fde68a" };
  if (noExam   || (zeroExam   && noCollect)) return { label:"‡∏£‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö", color:"#0891b2", bg:"#ecfeff", border:"#a5f3fc" };
  return null; // ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
}

// ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 71 ‡∏Ñ‡∏ô (‡∏°.1: 26, ‡∏°.2: 19, ‡∏°.3: 26)
const DEMO_STUDENTS = [
  { id: "1878", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏ô‡∏¥‡∏ä ‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏†‡∏£‡∏ì‡πå", level: "‡∏°.1" },
  { id: "1879", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏ô‡∏±‡∏ï‡∏ñ‡πå ‡∏ò‡∏±‡∏ô‡∏ô‡∏∞‡∏Å‡∏≤‡∏ô", level: "‡∏°.1" },
  { id: "1882", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏ü‡πâ‡∏≤‡∏ô‡∏¥‡∏°‡∏¥‡∏ï‡∏™‡∏ß‡∏¢", level: "‡∏°.1" },
  { id: "1883", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏õ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡πå ‡πÉ‡∏à‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏¢‡∏¥‡πà‡∏á", level: "‡∏°.1" },
  { id: "1885", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏¢‡∏®‡∏Å‡∏£ ‡∏ô‡∏±‡∏ô‡∏™‡∏ß‡πà‡∏≤‡∏á", level: "‡∏°.1" },
  { id: "1886", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏£‡∏±‡∏ê‡∏†‡∏π‡∏°‡∏¥ ‡πÉ‡∏à‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê‡∏¢‡∏¥‡πà‡∏á", level: "‡∏°.1" },
  { id: "1889", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏ä‡∏û‡∏£ ‡∏ß‡∏£‡∏à‡∏≤‡∏£‡∏∏‡∏ß‡∏£‡∏£‡∏ì", level: "‡∏°.1" },
  { id: "1891", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Ç‡∏ô‡∏¥‡∏©‡∏ê‡∏≤ ‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•", level: "‡∏°.1" },
  { id: "1892", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏à‡∏ô‡∏à‡∏¥‡∏£‡∏≤ ‡∏®‡∏¥‡∏£‡∏≤‡∏¢‡∏∏‡∏ó‡∏ò", level: "‡∏°.1" },
  { id: "1893", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏ö‡∏ç‡∏ç‡∏≤‡∏†‡∏≤ ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏≠‡∏£‡∏∏‡∏ì‡πÄ‡∏•‡∏¥‡∏®", level: "‡∏°.1" },
  { id: "1895", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏û‡∏¥‡∏å‡∏≤‡∏ç‡∏≤ ‡∏™‡∏Å‡∏∏‡∏•‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏ì‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡πå", level: "‡∏°.1" },
  { id: "1897", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏®‡∏®‡∏¥‡∏†‡∏£‡∏ì‡πå ‡∏™‡∏Å‡∏∏‡∏ì‡∏≤‡∏™‡∏µ‡∏ó‡∏≠‡∏á", level: "‡∏°.1" },
  { id: "1899", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏¥‡∏ô‡∏ò‡∏¥‡∏£‡∏≤ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ú‡∏•", level: "‡∏°.1" },
  { id: "2005", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÅ‡∏™‡∏á‡∏ï‡∏∞‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.1" },
  { id: "2055", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ö‡∏∏‡∏ç‡∏ç‡∏¥‡∏®‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.1" },
  { id: "2092", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ô‡∏±‡∏ê‡∏†‡∏π‡∏°‡∏¥ ‡∏õ‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°", level: "‡∏°.1" },
  { id: "2163", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏∏‡∏ò‡∏¥‡∏ô‡∏≤ ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏ß‡∏ô‡∏≤‡∏•‡∏±‡∏¢", level: "‡∏°.1" },
  { id: "2269", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏à‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏≥‡∏•‡∏≤‡∏†‡∏¢‡∏®", level: "‡∏°.1" },
  { id: "2270", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏ö‡∏∏‡∏ç‡∏ç‡∏§‡∏ó‡∏ò‡∏¥‡πå‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô", level: "‡∏°.1" },
  { id: "2271", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏ß‡∏±‡∏ä‡∏ä‡∏±‡∏¢ ‡∏ô‡∏∞‡∏ï‡∏¥‡∏Å‡∏≤", level: "‡∏°.1" },
  { id: "2272", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏û‡∏á‡∏£‡∏¥‡∏° ‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏°", level: "‡∏°.1" },
  { id: "2273", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÅ‡∏™‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.1" },
  { id: "2274", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏¥‡∏ä‡∏å‡∏≤‡∏†‡∏±‡∏©‡∏ì‡πå ‡∏Ñ‡∏µ‡∏£‡∏µ‡∏£‡∏∏‡πà‡∏á‡∏ñ‡∏≤‡∏ß‡∏£", level: "‡∏°.1" },
  { id: "2275", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏¢‡∏¥‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.1" },
  { id: "2276", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏ô‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏Å‡∏©‡∏°", level: "‡∏°.1" },
  { id: "2278", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏û‡∏á‡∏®‡∏Å‡∏£ ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏Å‡∏∏‡∏®‡∏•‡∏î‡∏µ", level: "‡∏°.1" },
  { id: "1859", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏≤‡∏ì‡∏∏‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏ã‡∏≠‡∏´‡∏ô‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≤", level: "‡∏°.2" },
  { id: "1860", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏°‡∏±‡∏á‡∏Å‡∏£ ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏µ", level: "‡∏°.2" },
  { id: "1861", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏™‡∏∏‡∏†‡∏ß‡∏±‡∏ó‡∏ô‡πå ‡∏ß‡∏±‡∏•‡∏™‡∏≤‡∏¢", level: "‡∏°.2" },
  { id: "1862", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå ‡∏Ñ‡∏µ‡∏£‡∏µ‡πÄ‡∏Ç‡∏ï‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì", level: "‡∏°.2" },
  { id: "1864", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÅ‡∏Ñ‡∏£‡πå ‡∏Ñ‡∏≥‡∏ü‡∏π", level: "‡∏°.2" },
  { id: "1867", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏∏‡∏î‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏õ‡∏ì‡∏¥‡∏ï‡∏≤‡∏ô‡∏ô‡∏ó‡πå", level: "‡∏°.2" },
  { id: "1875", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÄ‡∏à‡∏©‡∏é‡∏≤ ‡∏Ñ‡∏¥‡πâ‡∏ß‡∏™‡∏∏‡∏Ç‡∏à‡∏≥‡πÄ‡∏£‡∏¥‡∏ç", level: "‡∏°.2" },
  { id: "2212", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£‡πå ‡∏Ñ‡∏≥‡πÉ‡∏™", level: "‡∏°.2" },
  { id: "2234", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ã‡∏µ‡∏°‡∏á ‡πÅ‡∏ã‡πà‡πÄ‡∏´‡πà‡∏≠", level: "‡∏°.2" },
  { id: "2235", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏î‡∏£‡∏±‡∏ì‡∏†‡∏û ‡∏ß‡∏±‡∏í‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏Å‡∏∏‡∏•", level: "‡∏°.2" },
  { id: "2236", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏±‡∏ô‡∏ß‡∏≤ ‡∏¢‡∏≠‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏â‡∏•‡∏≤‡∏î", level: "‡∏°.2" },
  { id: "2238", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ß‡∏≤‡∏£‡∏¥‡∏® ‡∏™‡∏Å‡∏∏‡∏•‡∏Å‡∏£‡∏∞‡∏à‡πà‡∏≤‡∏á", level: "‡∏°.2" },
  { id: "2240", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏≠‡∏ô‡∏ß‡∏±‡∏ä ‡∏û‡∏£‡∏ô‡∏£‡∏≤‡∏û‡∏±‡∏ä‡∏£‡∏Å‡∏∏‡∏•", level: "‡∏°.2" },
  { id: "2241", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏±‡∏ç‡∏ç‡∏≤‡∏û‡∏±‡∏ä‡∏£ ‡∏°‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì", level: "‡∏°.2" },
  { id: "2242", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ò‡∏±‡∏ç‡∏™‡∏£‡∏ì‡πå ‡∏£‡∏±‡∏Å‡∏©‡πå‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°", level: "‡∏°.2" },
  { id: "2243", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏û‡∏ô‡∏¥‡∏î‡∏≤ ‡∏õ‡∏£‡∏∞‡∏†‡∏≤‡∏Å‡∏£‡πÄ‡∏ô‡∏ï‡∏£", level: "‡∏°.2" },
  { id: "2244", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏£‡∏±‡∏ä‡∏ô‡∏Å ‡∏Ç‡∏à‡∏£‡∏™‡∏¥‡∏£‡∏¥‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", level: "‡∏°.2" },
  { id: "2245", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏£‡∏û‡∏£‡∏£‡∏ì ‡∏≠‡∏°‡∏£‡∏ä‡∏±‡∏¢‡πÄ‡∏•‡∏¥‡∏®", level: "‡∏°.2" },
  { id: "2246", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏ï‡∏¥‡∏û‡∏£ ‡∏ó‡∏ß‡∏µ‡πÇ‡∏ä‡∏ï‡∏¥‡πÄ‡∏î‡∏ä‡∏≤", level: "‡∏°.2" },
  { id: "2253", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÑ‡∏Å‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡πÑ‡∏û‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡∏ß‡∏á‡∏®‡πå", level: "‡∏°.2" },
  { id: "1749", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ß‡∏±‡∏ô‡∏î‡∏µ ‡∏á‡∏≤‡∏°‡πÄ‡∏™‡∏°‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", level: "‡∏°.3" },
  { id: "1785", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏• ‡∏Ñ‡∏µ‡∏£‡∏µ‡∏™‡∏≤‡∏°‡∏™‡∏¥‡∏ö", level: "‡∏°.3" },
  { id: "1788", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏ô‡∏†‡∏±‡∏ó‡∏£ ‡πÇ‡∏ô‡∏ß‡∏£‡∏£‡∏ì", level: "‡∏°.3" },
  { id: "1789", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ô‡∏ß‡∏û‡∏• ‡∏£‡∏±‡∏ï‡∏ô‡∏∞‡∏ß‡∏±‡∏ô", level: "‡∏°.3" },
  { id: "1790", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ß‡∏£‡∏†‡∏±‡∏ó‡∏£ ‡∏£‡∏±‡∏ï‡∏ô‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏ó‡∏ß‡∏µ‡∏ú‡∏•", level: "‡∏°.3" },
  { id: "1793", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏ä‡∏Å‡∏£ ‡∏ä‡∏±‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", level: "‡∏°.3" },
  { id: "1870", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏•‡∏±‡∏Å‡∏©‡∏¥‡∏Å‡∏≤ ‡πÑ‡∏û‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á", level: "‡∏°.3" },
  { id: "1925", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ä‡∏≤‡∏ç‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‡∏≠‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡∏≤‡∏ô", level: "‡∏°.3" },
  { id: "2108", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏≠‡∏ô‡∏≤‡∏ß‡∏¥‡∏• ‡πÇ‡∏ä‡∏Ñ‡∏≠‡∏ô‡∏±‡∏ô‡∏Å‡∏∏‡∏•", level: "‡∏°.3" },
  { id: "2187", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ä‡∏ô‡∏≤‡∏ò‡∏¥‡∏õ ‡∏à‡∏¥‡∏£‡∏ß‡∏±‡∏ä‡∏£‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô", level: "‡∏°.3" },
  { id: "2190", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏°‡∏¥‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.3" },
  { id: "2191", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ß‡∏£‡∏≤‡∏Å‡∏£ ‡∏™‡∏Å‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡πÑ‡∏û‡∏£", level: "‡∏°.3" },
  { id: "2192", name: "‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ß‡∏µ‡∏£‡∏∞‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÅ‡∏ã‡πà‡πÄ‡∏ó‡πà‡∏≤", level: "‡∏°.3" },
  { id: "2195", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Ñ‡∏≥‡∏≠‡∏∏‡πà‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.3" },
  { id: "2196", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ä‡∏ç‡∏≤‡∏û‡∏£ ‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏°", level: "‡∏°.3" },
  { id: "2197", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏§‡∏î‡∏µ ‡∏î‡∏¥‡πÅ‡∏Æ", level: "‡∏°.3" },
  { id: "2198", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ô‡∏¥‡∏ä‡∏≤ ‡∏¢‡∏á‡∏¢‡∏®‡∏Å‡∏∏‡∏•", level: "‡∏°.3" },
  { id: "2199", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ö‡∏∏‡∏ì‡∏¢‡∏≤‡∏û‡∏£ ‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå", level: "‡∏°.3" },
  { id: "2200", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏¢‡∏∏‡∏ß‡∏î‡∏µ ‡πÅ‡∏ã‡πà‡πÄ‡∏´‡πà‡∏≠", level: "‡∏°.3" },
  { id: "2201", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ß‡∏≤‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ ‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏°", level: "‡∏°.3" },
  { id: "2202", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏¥‡∏£‡∏≤‡∏£‡∏°‡∏ì‡πå ‡∏Å‡∏£‡∏≠‡∏á‡∏°‡∏≤‡∏î‡∏µ", level: "‡∏°.3" },
  { id: "2203", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏¥‡∏£‡∏¥‡∏ô‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏ß‡∏µ‡∏£‡∏∞‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏Å‡∏•", level: "‡∏°.3" },
  { id: "2204", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏∏‡∏ä‡∏≤‡∏î‡∏≤ ‡∏¢‡∏¥‡πà‡∏á‡∏¢‡∏®‡∏™‡∏∏‡∏Ç", level: "‡∏°.3" },
  { id: "2205", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÅ‡∏™‡∏á‡∏Ñ‡∏≥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏∏‡∏•", level: "‡∏°.3" },
  { id: "2206", name: "‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á‡πÅ‡∏ã‡∏∞ ‡∏ò‡∏ô‡∏û‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏≤", level: "‡∏°.3" },
];

// ‚îÄ‚îÄ Storage helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function load(key) {
  try {
    const r = await window.storage.get(key);
    return r ? JSON.parse(r.value) : null;
  } catch { return null; }
}
async function save(key, val) {
  try { await window.storage.set(key, JSON.stringify(val)); } catch {}
}

// ‚îÄ‚îÄ Main App ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App() {
  const [role, setRole]           = useState(null);
  const [pinInput, setPinInput]   = useState("");
  const [pinErr, setPinErr]       = useState(false);
  const [students, setStudents]   = useState([]);
  const [scores, setScores]       = useState([]);
  const [templates, setTemplates] = useState({}); // subjectKey ‚Üí [{label,max}]
  const [teacherPin, setTeacherPin] = useState(DEFAULT_PIN);
  const [loaded, setLoaded]       = useState(false);

  useEffect(() => {
    (async () => {
      const sts  = await load("students_v2");
      const scs  = await load("scores_v2");
      const tmpl = await load("templates_v1");
      const tpin = await load("teacher_pin_v1");
      setStudents(sts  || DEMO_STUDENTS);
      setScores(scs    || []);
      setTemplates(tmpl || {});
      setTeacherPin(tpin || DEFAULT_PIN);
      setLoaded(true);
    })();
  }, []);

  const saveStudents  = useCallback(async (d) => { setStudents(d);  await save("students_v2", d); }, []);
  const saveScores    = useCallback(async (d) => { setScores(d);    await save("scores_v2", d); }, []);
  const saveTemplates = useCallback(async (d) => { setTemplates(d); await save("templates_v1", d); }, []);
  const savePin       = useCallback(async (d) => { setTeacherPin(d); await save("teacher_pin_v1", d); }, []);

  if (!loaded) return (
    <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:"100vh", background:"#0f2744" }}>
      <div style={{ color:"#60a5fa", fontFamily:"sans-serif", fontSize:16 }}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
  );

  if (!role) return <Landing onSelect={r => {
    if (r === "student") { setRole("student"); return; }
    setRole("pin");
  }} />;

  if (role === "pin") return (
    <PinScreen pin={pinInput} setPin={setPinInput} error={pinErr} onSubmit={() => {
      if (pinInput === teacherPin) { setRole("teacher"); setPinErr(false); setPinInput(""); }
      else { setPinErr(true); setPinInput(""); }
    }} onBack={() => { setRole(null); setPinInput(""); setPinErr(false); }} />
  );

  if (role === "student") return (
    <StudentView students={students} scores={scores} onBack={() => setRole(null)} />
  );

  return (
    <TeacherView
      students={students} setStudents={saveStudents}
      scores={scores}     setScores={saveScores}
      templates={templates} setTemplates={saveTemplates}
      teacherPin={teacherPin} setTeacherPin={savePin}
      onBack={() => setRole(null)}
    />
  );
}

// ‚îÄ‚îÄ Landing ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Landing({ onSelect }) {
  return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#0a1628 0%,#0f2744 50%,#0d1f3c 100%)", display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center", padding:"24px", fontFamily:"'Sarabun',sans-serif" }}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700;800&display=swap'); * { box-sizing: border-box; }`}</style>

      {/* Logo area */}
      <div style={{ marginBottom:8 }}>
        <div style={{ width:72, height:72, background:"linear-gradient(135deg,#3b82f6,#1d4ed8)", borderRadius:20, display:"flex", alignItems:"center", justifyContent:"center", fontSize:32, boxShadow:"0 8px 32px rgba(59,130,246,0.4)", margin:"0 auto" }}>üéì</div>
      </div>
      <div style={{ textAlign:"center", marginBottom:48 }}>
        <h1 style={{ color:"#fff", fontSize:26, fontWeight:800, margin:"16px 0 6px", letterSpacing:0.3 }}>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <p style={{ color:"#94a3b8", fontSize:15, margin:0 }}>‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‚Ä¢ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Ä¢ ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</p>
        <p style={{ color:"#64748b", fontSize:13, marginTop:6 }}>‡∏ä‡∏±‡πâ‡∏ô ‡∏°.1‚Äì3  |  ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ {CURRENT_YEAR}</p>
      </div>

      <div style={{ display:"flex", flexDirection:"column", gap:16, width:"100%", maxWidth:340 }}>
        <RoleCard icon="üîç" title="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" desc="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á" color="#3b82f6" onClick={() => onSelect("student")} />
        <RoleCard icon="üìù" title="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô" desc="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°" color="#0d9488" onClick={() => onSelect("teacher")} />
      </div>
    </div>
  );
}

function RoleCard({ icon, title, desc, color, onClick }) {
  const [hov, setHov] = useState(false);
  return (
    <button onClick={onClick}
      onMouseEnter={() => setHov(true)} onMouseLeave={() => setHov(false)}
      style={{ background: hov ? "rgba(255,255,255,0.1)" : "rgba(255,255,255,0.06)", border:`1.5px solid ${hov ? color : "rgba(255,255,255,0.12)"}`, borderRadius:16, padding:"20px 24px", cursor:"pointer", display:"flex", alignItems:"center", gap:16, textAlign:"left", transition:"all 0.2s", transform: hov ? "translateY(-2px)" : "none", boxShadow: hov ? `0 8px 24px rgba(0,0,0,0.3)` : "none", fontFamily:"'Sarabun',sans-serif" }}>
      <div style={{ width:48, height:48, background:`${color}22`, borderRadius:12, display:"flex", alignItems:"center", justifyContent:"center", fontSize:24, flexShrink:0 }}>{icon}</div>
      <div>
        <div style={{ color:"#fff", fontWeight:700, fontSize:18 }}>{title}</div>
        <div style={{ color:"#94a3b8", fontSize:13, marginTop:3 }}>{desc}</div>
      </div>
      <div style={{ marginLeft:"auto", color: color, fontSize:20 }}>‚Ä∫</div>
    </button>
  );
}

// ‚îÄ‚îÄ Pin Screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function PinScreen({ pin, setPin, error, onSubmit, onBack }) {
  return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#0a1628,#0f2744)", display:"flex", alignItems:"center", justifyContent:"center", padding:24, fontFamily:"'Sarabun',sans-serif" }}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap');`}</style>
      <div style={{ background:"rgba(255,255,255,0.06)", border:"1px solid rgba(255,255,255,0.12)", borderRadius:20, padding:"36px 32px", width:"100%", maxWidth:340, textAlign:"center" }}>
        <div style={{ fontSize:40, marginBottom:12 }}>üîê</div>
        <h2 style={{ color:"#fff", fontSize:20, fontWeight:700, marginBottom:6 }}>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π</h2>
        <p style={{ color:"#94a3b8", fontSize:14, marginBottom:24 }}>‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
        <input
          type="password" value={pin} onChange={e => setPin(e.target.value)}
          onKeyDown={e => e.key === "Enter" && onSubmit()}
          placeholder="PIN 4 ‡∏´‡∏•‡∏±‡∏Å"
          style={{ width:"100%", background:"rgba(255,255,255,0.08)", border:`1.5px solid ${error ? "#f87171" : "rgba(255,255,255,0.15)"}`, borderRadius:10, padding:"12px 16px", color:"#fff", fontSize:18, textAlign:"center", letterSpacing:8, fontFamily:"monospace", outline:"none", marginBottom:8 }}
        />
        {error && <p style={{ color:"#f87171", fontSize:13, marginBottom:8 }}>PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>}
        <button onClick={onSubmit} style={{ width:"100%", background:"linear-gradient(135deg,#3b82f6,#1d4ed8)", border:"none", borderRadius:10, padding:"12px", color:"#fff", fontSize:16, fontWeight:700, cursor:"pointer", marginBottom:12, fontFamily:"'Sarabun',sans-serif" }}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button onClick={onBack} style={{ background:"none", border:"none", color:"#64748b", fontSize:14, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <p style={{ color:"#334155", fontSize:12, marginTop:16 }}>PIN ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 1234</p>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Student View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function StudentView({ students, scores, onBack }) {
  const [query, setQuery] = useState("");
  const [found, setFound] = useState(null);
  const [searched, setSearched] = useState(false);

  const search = () => {
    const q = query.trim().toLowerCase();
    if (!q) return;
    const st = students.find(s => s.id === q || s.name.toLowerCase().includes(q));
    setFound(st || null);
    setSearched(true);
  };

  const getScores = (studentId) =>
    scores.filter(s => s.studentId === studentId && s.year === CURRENT_YEAR && s.term === CURRENT_TERM);

  return (
    <div style={{ minHeight:"100vh", background:"#f8fafc", fontFamily:"'Sarabun',sans-serif" }}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700;800&display=swap');`}</style>

      {/* Header */}
      <div style={{ background:"linear-gradient(135deg,#0f2744,#1a56db)", padding:"20px 24px", color:"#fff" }}>
        <button onClick={onBack} style={{ background:"rgba(255,255,255,0.15)", border:"none", color:"#fff", borderRadius:8, padding:"6px 14px", cursor:"pointer", fontSize:13, fontFamily:"'Sarabun',sans-serif", marginBottom:16 }}>‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
        <h1 style={{ fontSize:22, fontWeight:800, margin:"0 0 4px" }}>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <p style={{ color:"rgba(255,255,255,0.7)", fontSize:14, margin:0 }}>‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà {CURRENT_TERM} ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ {CURRENT_YEAR}</p>
      </div>

      <div style={{ maxWidth:640, margin:"0 auto", padding:"24px 16px" }}>
        {/* Search */}
        <div style={{ background:"#fff", borderRadius:16, padding:20, boxShadow:"0 2px 12px rgba(0,0,0,0.06)", marginBottom:20 }}>
          <p style={{ color:"#374151", fontWeight:600, fontSize:15, marginBottom:12 }}>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          <div style={{ display:"flex", gap:10 }}>
            <input value={query} onChange={e => setQuery(e.target.value)}
              onKeyDown={e => e.key === "Enter" && search()}
              placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..."
              style={{ flex:1, border:"1.5px solid #e2e8f0", borderRadius:10, padding:"11px 14px", fontSize:15, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b" }}
            />
            <button onClick={search} style={{ background:"#1a56db", border:"none", borderRadius:10, padding:"0 20px", color:"#fff", fontSize:15, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          </div>
        </div>

        {/* Result */}
        {searched && !found && (
          <div style={{ background:"#fff", borderRadius:16, padding:32, textAlign:"center", boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
            <div style={{ fontSize:48, marginBottom:12 }}>üîé</div>
            <p style={{ color:"#64748b", fontSize:16 }}>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
          </div>
        )}

        {found && (() => {
          const myScores = getScores(found.id);
          const hasScores = myScores.length > 0;
          return (
            <div>
              {/* Student info card */}
              <div style={{ background:"linear-gradient(135deg,#1a56db,#0d9488)", borderRadius:16, padding:"20px 24px", color:"#fff", marginBottom:16, boxShadow:"0 4px 20px rgba(26,86,219,0.3)" }}>
                <div style={{ display:"flex", alignItems:"center", gap:16 }}>
                  <div style={{ width:56, height:56, background:"rgba(255,255,255,0.2)", borderRadius:14, display:"flex", alignItems:"center", justifyContent:"center", fontSize:28 }}>üë§</div>
                  <div>
                    <div style={{ fontSize:20, fontWeight:800 }}>{found.name}</div>
                    <div style={{ color:"rgba(255,255,255,0.8)", fontSize:14, marginTop:3 }}>‡∏£‡∏´‡∏±‡∏™ {found.id}  |  ‡∏ä‡∏±‡πâ‡∏ô {found.level}</div>
                  </div>
                </div>
              </div>

              {!hasScores ? (
                <div style={{ background:"#fff", borderRadius:16, padding:28, textAlign:"center", boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
                  <p style={{ color:"#94a3b8", fontSize:15 }}>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ</p>
                </div>
              ) : (
                <div style={{ display:"flex", flexDirection:"column", gap:12 }}>
                  {myScores.map((sc, i) => {
                    const total = (Number(sc.collect) || 0) + (Number(sc.exam) || 0);
                    const grade = calcGrade(total);
                    const gc = gradeColor(grade);
                    return (
                      <div key={i} style={{ background:"#fff", borderRadius:16, overflow:"hidden", boxShadow:"0 2px 12px rgba(0,0,0,0.06)", border:`1.5px solid ${gc.border}` }}>
                        <div style={{ background:gc.bg, padding:"12px 20px", borderBottom:`1px solid ${gc.border}`, display:"flex", alignItems:"center", justifyContent:"space-between" }}>
                          <span style={{ fontWeight:700, fontSize:16, color:gc.text }}>üìö {sc.subject}</span>
                          {(() => { const ps = scoreStatus(sc); return ps ? (
                            <span style={{ background:ps.bg, border:`1px solid ${ps.border}`, color:ps.color, borderRadius:20, padding:"3px 12px", fontSize:12, fontWeight:700 }}>‚è≥ {ps.label}</span>
                          ) : null; })()}
                        </div>
                        <div style={{ padding:"16px 20px" }}>
                          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:12, marginBottom:16 }}>
                            <ScoreBox label="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö" value={sc.collect} max={sc.maxCollect || 60} pending={String(sc.collect)==="" || sc.collect===null} />
                            <ScoreBox label="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö" value={sc.exam} max={sc.maxExam || 40} pending={String(sc.exam)==="" || sc.exam===null} />
                            <ScoreBox label="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°" value={total} max={100} bold />
                          </div>
                          {/* ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏¢‡∏Å‡∏¢‡πà‡∏≠‡∏¢ */}
                          {sc.subScores && sc.subScores.length > 0 && (
                            <div style={{ marginBottom:14 }}>
                              <div style={{ fontSize:12, color:"#64748b", fontWeight:600, marginBottom:6 }}>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö</div>
                              <div style={{ display:"flex", flexDirection:"column", gap:5 }}>
                                {sc.subScores.map((sub, si) => {
                                  const pct = sub.max > 0 ? Math.min(100, ((Number(sub.value)||0)/Number(sub.max))*100) : 0;
                                  const isPending = sub.value === "" || sub.value === null || sub.value === undefined;
                                  return (
                                    <div key={si} style={{ display:"flex", alignItems:"center", gap:10 }}>
                                      <div style={{ fontSize:12, color:"#374151", minWidth:0, flex:"0 0 auto", maxWidth:160, whiteSpace:"nowrap", overflow:"hidden", textOverflow:"ellipsis" }}>
                                        {sub.label || `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ${si+1}`}
                                      </div>
                                      <div style={{ flex:1, height:8, background:"#f1f5f9", borderRadius:4, overflow:"hidden" }}>
                                        <div style={{ height:"100%", width:`${pct}%`, background: isPending ? "#fde68a" : pct>=80?"#3b82f6":pct>=50?"#10b981":"#f87171", borderRadius:4, transition:"width 0.4s" }} />
                                      </div>
                                      <div style={{ fontSize:12, fontWeight:700, color: isPending?"#d97706":"#1e293b", minWidth:52, textAlign:"right" }}>
                                        {isPending ? "‡∏£‡∏≠‡∏ú‡∏•" : `${sub.value}/${sub.max}`}
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            </div>
                          )}
                          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between" }}>
                            <div>
                              <span style={{ fontSize:13, color:"#64748b" }}>‡πÄ‡∏Å‡∏£‡∏î</span>
                              <span style={{ fontSize:32, fontWeight:800, color:gc.text, marginLeft:10 }}>{grade}</span>
                            </div>
                            {(() => { const ps = scoreStatus(sc); return ps ? (
                              <div style={{ background:ps.bg, border:`1.5px solid ${ps.border}`, borderRadius:10, padding:"8px 18px" }}>
                                <span style={{ fontSize:14, fontWeight:700, color:ps.color }}>‚è≥ {ps.label}</span>
                              </div>
                            ) : (
                              <div style={{ background:gc.bg, border:`1.5px solid ${gc.border}`, borderRadius:10, padding:"8px 18px" }}>
                                <span style={{ fontSize:15, fontWeight:700, color:gc.text }}>{grade === "0" ? "‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô" : "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô"}</span>
                              </div>
                            ); })()}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          );
        })()}
      </div>
    </div>
  );
}

function ScoreBox({ label, value, max, bold, pending }) {
  const pct = max > 0 ? Math.min(100, ((Number(value)||0)/max)*100) : 0;
  if (pending) return (
    <div style={{ background:"#fffbeb", borderRadius:10, padding:"10px 12px", textAlign:"center", border:"1.5px dashed #fde68a" }}>
      <div style={{ fontSize:12, color:"#92400e", marginBottom:4, fontWeight:600 }}>{label}</div>
      <div style={{ fontSize:15, fontWeight:700, color:"#d97706" }}>‡∏£‡∏≠‡∏ú‡∏•</div>
      <div style={{ fontSize:11, color:"#fbbf24" }}>/{max}</div>
      <div style={{ height:4, background:"#fef3c7", borderRadius:2, marginTop:6 }} />
    </div>
  );
  return (
    <div style={{ background:"#f8fafc", borderRadius:10, padding:"10px 12px", textAlign:"center" }}>
      <div style={{ fontSize:12, color:"#64748b", marginBottom:4 }}>{label}</div>
      <div style={{ fontSize: bold ? 22 : 18, fontWeight: bold ? 800 : 700, color:"#1e293b" }}>{value ?? "-"}</div>
      <div style={{ fontSize:11, color:"#94a3b8" }}>/{max}</div>
      <div style={{ height:4, background:"#e2e8f0", borderRadius:2, marginTop:6 }}>
        <div style={{ height:"100%", width:`${pct}%`, background: pct >= 80 ? "#3b82f6" : pct >= 50 ? "#10b981" : "#f87171", borderRadius:2, transition:"width 0.5s" }} />
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Teacher View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function TeacherView({ students, setStudents, scores, setScores, templates, setTemplates, teacherPin, setTeacherPin, onBack }) {
  const [tab, setTab] = useState("score");

  return (
    <div style={{ minHeight:"100vh", background:"#f1f5f9", fontFamily:"'Sarabun',sans-serif" }}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700;800&display=swap'); * { box-sizing:border-box; }`}</style>

      <div style={{ background:"linear-gradient(135deg,#0f2744,#0d9488)", padding:"18px 24px", color:"#fff", display:"flex", alignItems:"center", gap:16 }}>
        <button onClick={onBack} style={{ background:"rgba(255,255,255,0.15)", border:"none", color:"#fff", borderRadius:8, padding:"6px 14px", cursor:"pointer", fontSize:13, fontFamily:"'Sarabun',sans-serif" }}>‚Üê ‡∏≠‡∏≠‡∏Å</button>
        <div>
          <h1 style={{ fontSize:19, fontWeight:800, margin:0 }}>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚Äî ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</h1>
          <p style={{ color:"rgba(255,255,255,0.7)", fontSize:13, margin:0 }}>‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô {CURRENT_TERM}/{CURRENT_YEAR}</p>
        </div>
      </div>

      <div style={{ background:"#fff", borderBottom:"1px solid #e2e8f0", display:"flex", padding:"0 20px", overflowX:"auto" }}>
        {[["score","üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"],["templates","üìã ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î/‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô"],["students","üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"],["dashboard","üìä Dashboard"],["settings","‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤"]].map(([key,label]) => (
          <button key={key} onClick={() => setTab(key)}
            style={{ background:"none", border:"none", borderBottom: tab===key ? "3px solid #1a56db" : "3px solid transparent", color: tab===key ? "#1a56db" : "#64748b", fontWeight: tab===key ? 700 : 400, fontSize:14, padding:"14px 18px", cursor:"pointer", fontFamily:"'Sarabun',sans-serif", whiteSpace:"nowrap" }}>
            {label}
          </button>
        ))}
      </div>

      <div style={{ maxWidth:960, margin:"0 auto", padding:"20px 16px" }}>
        {tab === "score"     && <ScoreInput students={students} scores={scores} setScores={setScores} templates={templates} />}
        {tab === "templates" && <TemplateManager templates={templates} setTemplates={setTemplates} />}
        {tab === "students"  && <StudentManager students={students} setStudents={setStudents} scores={scores} />}
        {tab === "dashboard" && <Dashboard students={students} scores={scores} />}
        {tab === "settings"  && <Settings teacherPin={teacherPin} setTeacherPin={setTeacherPin} />}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Score Input ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEFAULT_SUB = [{ label: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏°", max: 60, value: "" }];

function ScoreInput({ students, scores, setScores, templates }) {
  const [level, setLevel] = useState("");
  const [form, setForm]   = useState({ studentId:"", subject:"", exam:"", maxExam:40 });
  const [subScores, setSubScores] = useState(DEFAULT_SUB);
  const [saved, setSaved] = useState(false);

  const filteredStudents   = level ? students.filter(s => s.level === level) : [];
  const selectedStudent    = students.find(s => s.id === form.studentId);
  const subjectsForStudent = selectedStudent ? ALL_SUBJECTS.filter(s => s.includes(selectedStudent.level)) : [];

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ ‚Üí ‡πÇ‡∏´‡∏•‡∏î template (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  const handleSubjectChange = (subject) => {
    const tmpl = templates[subject];
    if (tmpl && tmpl.items && tmpl.items.length > 0) {
      setSubScores(tmpl.items.map(t => ({ label:t.label, max:t.max, value:"" })));
      setForm(f => ({...f, subject, maxExam: tmpl.maxExam || 40 }));
    } else {
      setSubScores(DEFAULT_SUB);
      setForm(f => ({...f, subject}));
    }
  };

  // ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≤‡∏Å sub-scores
  const collectTotal    = subScores.reduce((a, s) => a + (Number(s.value) || 0), 0);
  const maxCollectTotal = subScores.reduce((a, s) => a + (Number(s.max)   || 0), 0);
  const examVal         = Number(form.exam) || 0;
  const grandTotal      = collectTotal + examVal;
  const examErr         = form.exam !== "" && (examVal < 0 || examVal > form.maxExam);
  const subErrors       = subScores.map(s => s.value !== "" && (Number(s.value) < 0 || Number(s.value) > Number(s.max)));
  const hasErr          = examErr || subErrors.some(Boolean);
  const canSave         = form.studentId && form.subject && !hasErr;

  const addSub    = () => setSubScores([...subScores, { label:"", max:10, value:"" }]);
  const removeSub = (i) => setSubScores(subScores.filter((_, idx) => idx !== i));
  const updateSub = (i, key, val) => setSubScores(subScores.map((s, idx) => idx === i ? {...s, [key]: val} : s));

  const handleSave = () => {
    if (!canSave) return;
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á sc.collect = ‡∏ú‡∏•‡∏£‡∏ß‡∏° sub-scores (‡∏´‡∏£‡∏∑‡∏≠ "" ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å)
    const collectVal = subScores.every(s => s.value === "") ? "" : String(collectTotal);
    const entry = {
      studentId: form.studentId, subject: form.subject,
      collect: collectVal, exam: form.exam,
      maxCollect: maxCollectTotal, maxExam: form.maxExam,
      subScores: subScores.map(s => ({...s})),
      year: CURRENT_YEAR, term: CURRENT_TERM
    };
    let ns = [...scores];
    const idx = ns.findIndex(s => s.studentId===form.studentId && s.subject===form.subject && s.year===CURRENT_YEAR && s.term===CURRENT_TERM);
    if (idx >= 0) ns[idx] = entry; else ns.push(entry);
    setScores(ns);
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  const loadEdit = (sc) => {
    const st = students.find(s => s.id === sc.studentId);
    if (st) setLevel(st.level);
    setForm({ studentId:sc.studentId, subject:sc.subject, exam:sc.exam, maxExam:sc.maxExam||40 });
    setSubScores(sc.subScores && sc.subScores.length > 0 ? sc.subScores : DEFAULT_SUB);
  };

  const deleteScore = (sc) => {
    setScores(scores.filter(s => !(s.studentId===sc.studentId && s.subject===sc.subject && s.year===sc.year && s.term===sc.term)));
  };

  const currentTermScores = scores.filter(s => s.year===CURRENT_YEAR && s.term===CURRENT_TERM);

  return (
    <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:20, alignItems:"start" }}>
      {/* ‚îÄ‚îÄ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‚îÄ‚îÄ */}
      <div style={{ background:"#fff", borderRadius:16, padding:24, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:16, fontWeight:700, color:"#0f2744", marginBottom:20 }}>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>

        {/* 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô */}
        <Label>1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</Label>
        <div style={{ display:"flex", gap:8, marginBottom:16 }}>
          {LEVELS.map(lv => (
            <button key={lv} onClick={() => { setLevel(lv); setForm(f => ({...f, studentId:"", subject:""})); }}
              style={{ flex:1, padding:"10px 0", borderRadius:10, border:`2px solid ${level===lv ? "#1a56db" : "#e2e8f0"}`, background: level===lv ? "#eff6ff" : "#f8fafc", color: level===lv ? "#1a56db" : "#64748b", fontWeight: level===lv ? 700 : 400, fontSize:15, cursor:"pointer", fontFamily:"'Sarabun',sans-serif", transition:"all 0.15s" }}>
              {lv}
            </button>
          ))}
        </div>

        {/* 2-3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡∏ß‡∏¥‡∏ä‡∏≤ */}
        {level ? (
          <>
            <Label>2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ({filteredStudents.length} ‡∏Ñ‡∏ô)</Label>
            <select value={form.studentId} onChange={e => setForm({...form, studentId:e.target.value, subject:""})} style={selectStyle}>
              <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô {level} ‚Äî</option>
              {filteredStudents.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
            </select>
            <Label>3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</Label>
            <select value={form.subject} onChange={e => handleSubjectChange(e.target.value)}
              style={{...selectStyle, opacity:!form.studentId?0.5:1}} disabled={!form.studentId}>
              <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ ‚Äî</option>
              {subjectsForStudent.map(s => <option key={s} value={s}>{s}</option>)}
            </select>
            {form.subject && templates[form.subject]?.items?.length > 0 && (
              <div style={{ background:"#f0fdf4", border:"1px solid #86efac", borderRadius:8, padding:"6px 12px", fontSize:12, color:"#166534", marginBottom:8 }}>
                ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î/‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô {templates[form.subject].items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÅ‡∏•‡πâ‡∏ß
              </div>
            )}
          </>
        ) : (
          <div style={{ background:"#f8fafc", border:"1.5px dashed #e2e8f0", borderRadius:12, padding:18, textAlign:"center", marginBottom:12 }}>
            <p style={{ color:"#94a3b8", fontSize:14, margin:0 }}>üëÜ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
          </div>
        )}

        {/* 4. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö ‚Äî ‡πÅ‡∏¢‡∏Å‡∏¢‡πà‡∏≠‡∏¢ */}
        <div style={{ marginTop:4, marginBottom:4 }}>
          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:8 }}>
            <Label>4. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö {form.subject && templates[form.subject]?.items?.length > 0 ? "(‡∏à‡∏≤‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï)" : "‚Äî ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î"}</Label>
            <button onClick={addSub}
              style={{ background:"#eff6ff", border:"1px solid #bfdbfe", color:"#1a56db", borderRadius:8, padding:"4px 12px", fontSize:12, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>
              + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á
            </button>
          </div>

          <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
            {subScores.map((s, i) => (
              <div key={i} style={{ background:"#f8fafc", borderRadius:10, padding:"10px 12px", border:"1px solid #e2e8f0" }}>
                <div style={{ display:"flex", gap:8, marginBottom:6, alignItems:"center" }}>
                  <input
                    value={s.label}
                    onChange={e => updateSub(i, "label", e.target.value)}
                    placeholder={`‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà ${i+1}, ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô ${i+1}`}
                    style={{ flex:1, border:"1.5px solid #e2e8f0", borderRadius:7, padding:"6px 10px", fontSize:13, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b" }}
                  />
                  {subScores.length > 1 && (
                    <button onClick={() => removeSub(i)}
                      style={{ background:"#fee2e2", border:"none", borderRadius:7, padding:"6px 10px", fontSize:12, cursor:"pointer", color:"#dc2626", fontFamily:"'Sarabun',sans-serif", flexShrink:0 }}>
                      ‚úï
                    </button>
                  )}
                </div>
                <div style={{ display:"flex", gap:8, alignItems:"center" }}>
                  <div style={{ flex:1 }}>
                    <div style={{ fontSize:11, color:"#94a3b8", marginBottom:3 }}>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                    <input type="number" value={s.max} onChange={e => updateSub(i, "max", e.target.value)}
                      style={{ width:"100%", border:"1.5px solid #e2e8f0", borderRadius:7, padding:"6px 10px", fontSize:14, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b" }} />
                  </div>
                  <div style={{ flex:1 }}>
                    <div style={{ fontSize:11, color:"#94a3b8", marginBottom:3 }}>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</div>
                    <input type="number" value={s.value} onChange={e => updateSub(i, "value", e.target.value)}
                      placeholder="‚Äî"
                      style={{ width:"100%", border:`1.5px solid ${subErrors[i] ? "#f87171" : "#e2e8f0"}`, borderRadius:7, padding:"6px 10px", fontSize:14, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b" }} />
                    {subErrors[i] && <span style={{ fontSize:11, color:"#f87171" }}>‡πÄ‡∏Å‡∏¥‡∏ô {s.max}</span>}
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö */}
          <div style={{ background:"#eff6ff", border:"1px solid #bfdbfe", borderRadius:10, padding:"8px 14px", marginTop:8, display:"flex", justifyContent:"space-between", alignItems:"center" }}>
            <span style={{ fontSize:13, color:"#1e40af", fontWeight:600 }}>‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö</span>
            <span style={{ fontSize:16, fontWeight:800, color:"#1a56db" }}>{collectTotal} / {maxCollectTotal}</span>
          </div>
        </div>

        {/* 5. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö */}
        <div style={{ marginTop:12 }}>
          <div style={{ display:"flex", gap:12 }}>
            <div style={{ flex:1 }}>
              <Label>5. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏™‡∏≠‡∏ö)</Label>
              <input type="number" value={form.maxExam} onChange={e => setForm({...form, maxExam:Number(e.target.value)})} style={inputStyle} />
            </div>
            <div style={{ flex:1 }}>
              <Label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö (0‚Äì{form.maxExam})</Label>
              <input type="number" value={form.exam} onChange={e => setForm({...form, exam:e.target.value})}
                style={{...inputStyle, borderColor: examErr ? "#f87171" : "#e2e8f0"}} placeholder="‚Äî" />
              {examErr && <span style={{ color:"#f87171", fontSize:12 }}>‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span>}
            </div>
          </div>
        </div>

        {/* Preview ‡πÄ‡∏Å‡∏£‡∏î */}
        {(collectTotal > 0 || examVal > 0) && (() => {
          const g = calcGrade(grandTotal); const gc = gradeColor(g);
          return (
            <div style={{ background:gc.bg, border:`1.5px solid ${gc.border}`, borderRadius:12, padding:"12px 16px", marginTop:12, display:"flex", justifyContent:"space-between", alignItems:"center" }}>
              <span style={{ fontSize:14, color:gc.text }}>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° <strong>{grandTotal} / {maxCollectTotal + Number(form.maxExam)}</strong></span>
              <span style={{ fontSize:20, fontWeight:800, color:gc.text }}>‡πÄ‡∏Å‡∏£‡∏î {g}</span>
              <span style={{ fontSize:13, color:gc.text }}>{g === "0" ? "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô" : "‡∏ú‡πà‡∏≤‡∏ô"}</span>
            </div>
          );
        })()}

        <button onClick={handleSave} disabled={!canSave}
          style={{ width:"100%", marginTop:14, background: !canSave ? "#e2e8f0" : "linear-gradient(135deg,#1a56db,#0d9488)", border:"none", borderRadius:10, padding:13, color: !canSave ? "#94a3b8" : "#fff", fontSize:16, fontWeight:700, cursor: !canSave ? "not-allowed" : "pointer", fontFamily:"'Sarabun',sans-serif", transition:"all 0.2s" }}>
          {saved ? "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!" : "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"}
        </button>
      </div>

      {/* ‚îÄ‚îÄ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚îÄ‚îÄ */}
      <div style={{ background:"#fff", borderRadius:16, padding:24, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:16, fontWeight:700, color:"#0f2744", marginBottom:16 }}>üìã ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ({currentTermScores.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
        {currentTermScores.length === 0 ? (
          <p style={{ color:"#94a3b8", textAlign:"center", padding:20 }}>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        ) : (
          <div style={{ display:"flex", flexDirection:"column", gap:8, maxHeight:560, overflowY:"auto" }}>
            {currentTermScores.map((sc, i) => {
              const st = students.find(s => s.id === sc.studentId);
              const total = (Number(sc.collect)||0) + (Number(sc.exam)||0);
              const g = calcGrade(total); const gc = gradeColor(g);
              const hasSubs = sc.subScores && sc.subScores.length > 0;
              return (
                <div key={i} style={{ background:"#f8fafc", borderRadius:12, border:`1px solid ${gc.border}`, overflow:"hidden" }}>
                  <div style={{ padding:"10px 14px", display:"flex", alignItems:"center", gap:10 }}>
                    <div style={{ flex:1, minWidth:0 }}>
                      <div style={{ fontSize:13, fontWeight:700, color:"#1e293b", whiteSpace:"nowrap", overflow:"hidden", textOverflow:"ellipsis" }}>{st?.name || sc.studentId}</div>
                      <div style={{ fontSize:12, color:"#64748b", display:"flex", alignItems:"center", gap:6, flexWrap:"wrap" }}>
                        {sc.subject} | <span style={{ color:"#94a3b8" }}>{st?.level}</span>
                        {(() => { const ps = scoreStatus(sc); return ps ? (
                          <span style={{ background:ps.bg, border:`1px solid ${ps.border}`, color:ps.color, borderRadius:10, padding:"1px 8px", fontSize:11, fontWeight:700 }}>‚è≥ {ps.label}</span>
                        ) : null; })()}
                      </div>
                      <div style={{ fontSize:12, color:"#94a3b8" }}>
                        ‡πÄ‡∏Å‡πá‡∏ö {sc.collect===""||sc.collect===null?"‚Äî":sc.collect}/{sc.maxCollect||60} + ‡∏™‡∏≠‡∏ö {sc.exam===""||sc.exam===null?"‚Äî":sc.exam}/{sc.maxExam||40} = {total}
                      </div>
                    </div>
                    <div style={{ fontSize:18, fontWeight:800, color:gc.text, minWidth:28, textAlign:"center" }}>{g}</div>
                    <div style={{ display:"flex", gap:6 }}>
                      <button onClick={() => loadEdit(sc)} style={{ background:"#dbeafe", border:"none", borderRadius:6, padding:"4px 10px", fontSize:12, cursor:"pointer", color:"#1e40af", fontFamily:"'Sarabun',sans-serif" }}>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                      <button onClick={() => deleteScore(sc)} style={{ background:"#fee2e2", border:"none", borderRadius:6, padding:"4px 10px", fontSize:12, cursor:"pointer", color:"#dc2626", fontFamily:"'Sarabun',sans-serif" }}>‡∏•‡∏ö</button>
                    </div>
                  </div>
                  {/* ‡πÅ‡∏™‡∏î‡∏á sub-scores */}
                  {hasSubs && (
                    <div style={{ borderTop:"1px solid #e2e8f0", padding:"8px 14px", background:"#fff", display:"flex", flexWrap:"wrap", gap:6 }}>
                      {sc.subScores.map((sub, si) => (
                        <div key={si} style={{ background:"#f1f5f9", borderRadius:8, padding:"4px 10px", fontSize:12 }}>
                          <span style={{ color:"#64748b" }}>{sub.label || `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ${si+1}`}: </span>
                          <span style={{ fontWeight:700, color: sub.value===""?"#d97706":"#1e293b" }}>
                            {sub.value===""?"‡∏£‡∏≠‡∏ú‡∏•":sub.value}
                          </span>
                          <span style={{ color:"#94a3b8" }}>/{sub.max}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Student Manager ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function StudentManager({ students, setStudents, scores }) {
  const [form, setForm] = useState({ id:"", name:"", level:"‡∏°.1" });
  const [msg, setMsg] = useState("");

  const addStudent = () => {
    if (!form.id || !form.name) return;
    if (students.find(s => s.id === form.id)) { setMsg("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"); return; }
    setStudents([...students, { ...form }]);
    setForm({ id:"", name:"", level:"‡∏°.1" });
    setMsg("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß"); setTimeout(() => setMsg(""), 2000);
  };

  const removeStudent = (id) => {
    setStudents(students.filter(s => s.id !== id));
  };

  return (
    <div style={{ display:"grid", gridTemplateColumns:"320px 1fr", gap:20, alignItems:"start" }}>
      <div style={{ background:"#fff", borderRadius:16, padding:24, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:16, fontWeight:700, color:"#0f2744", marginBottom:20 }}>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
        <Label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</Label>
        <input value={form.id} onChange={e => setForm({...form, id:e.target.value})} placeholder="‡πÄ‡∏ä‡πà‡∏ô 10001" style={inputStyle} />
        <Label>‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•</Label>
        <input value={form.name} onChange={e => setForm({...form, name:e.target.value})} placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•" style={inputStyle} />
        <Label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</Label>
        <select value={form.level} onChange={e => setForm({...form, level:e.target.value})} style={selectStyle}>
          {LEVELS.map(l => <option key={l} value={l}>{l}</option>)}
        </select>
        {msg && <p style={{ fontSize:13, color: msg.startsWith("‚úÖ") ? "#16a34a" : "#dc2626", margin:"8px 0" }}>{msg}</p>}
        <button onClick={addStudent} style={{ width:"100%", marginTop:8, background:"linear-gradient(135deg,#0f2744,#1a56db)", border:"none", borderRadius:10, padding:"12px", color:"#fff", fontSize:15, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
        <p style={{ fontSize:12, color:"#94a3b8", marginTop:12, textAlign:"center" }}>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ {students.length} ‡∏Ñ‡∏ô</p>
      </div>

      <div style={{ background:"#fff", borderRadius:16, padding:24, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:16, fontWeight:700, color:"#0f2744", marginBottom:16 }}>üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div style={{ display:"flex", flexDirection:"column", gap:8, maxHeight:500, overflowY:"auto" }}>
          {students.map(s => {
            const sc = scores.filter(sc => sc.studentId === s.id && sc.year === CURRENT_YEAR && sc.term === CURRENT_TERM);
            return (
              <div key={s.id} style={{ display:"flex", alignItems:"center", gap:12, padding:"10px 14px", background:"#f8fafc", borderRadius:10, border:"1px solid #e2e8f0" }}>
                <div style={{ width:36, height:36, background:"#dbeafe", borderRadius:10, display:"flex", alignItems:"center", justifyContent:"center", fontSize:16 }}>üë§</div>
                <div style={{ flex:1 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#1e293b" }}>{s.name}</div>
                  <div style={{ fontSize:12, color:"#64748b" }}>‡∏£‡∏´‡∏±‡∏™ {s.id}  |  {s.level}  |  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß {sc.length} ‡∏ß‡∏¥‡∏ä‡∏≤</div>
                </div>
                <button onClick={() => removeStudent(s.id)} style={{ background:"#fee2e2", border:"none", borderRadius:7, padding:"5px 12px", fontSize:12, cursor:"pointer", color:"#dc2626", fontFamily:"'Sarabun',sans-serif" }}>‡∏•‡∏ö</button>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Template Manager ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function TemplateManager({ templates, setTemplates }) {
  const [selSubject, setSelSubject] = useState("");
  const [items, setItems]           = useState([]);
  const [maxExam, setMaxExam]       = useState(40);
  const [saved, setSaved]           = useState(false);

  const loadTemplate = (subj) => {
    setSelSubject(subj);
    const t = templates[subj];
    if (t) { setItems(t.items || []); setMaxExam(t.maxExam || 40); }
    else   { setItems([{ label:"", max:10 }]); setMaxExam(40); }
  };

  const addItem    = () => setItems([...items, { label:"", max:10 }]);
  const removeItem = (i) => setItems(items.filter((_, idx) => idx !== i));
  const updateItem = (i, key, val) => setItems(items.map((it, idx) => idx === i ? {...it, [key]: val} : it));

  const handleSave = () => {
    if (!selSubject) return;
    const next = { ...templates, [selSubject]: { items: items.map(it => ({...it})), maxExam: Number(maxExam) } };
    setTemplates(next);
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  const handleDelete = () => {
    if (!selSubject) return;
    const next = { ...templates };
    delete next[selSubject];
    setTemplates(next);
    setItems([{ label:"", max:10 }]);
    setSaved(false);
  };

  const totalMax = items.reduce((a, it) => a + (Number(it.max) || 0), 0);

  return (
    <div style={{ display:"grid", gridTemplateColumns:"280px 1fr", gap:20, alignItems:"start" }}>
      {/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ */}
      <div style={{ background:"#fff", borderRadius:16, padding:20, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:15, fontWeight:700, color:"#0f2744", marginBottom:14 }}>üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
        <div style={{ display:"flex", flexDirection:"column", gap:6 }}>
          {ALL_SUBJECTS.map(subj => {
            const hasTmpl = templates[subj]?.items?.length > 0;
            return (
              <button key={subj} onClick={() => loadTemplate(subj)}
                style={{ textAlign:"left", padding:"10px 14px", borderRadius:10, border:`1.5px solid ${selSubject===subj ? "#1a56db" : "#e2e8f0"}`, background: selSubject===subj ? "#eff6ff" : "#f8fafc", cursor:"pointer", fontFamily:"'Sarabun',sans-serif", fontSize:13, color: selSubject===subj ? "#1a56db" : "#374151", display:"flex", justifyContent:"space-between", alignItems:"center" }}>
                <span>{subj}</span>
                {hasTmpl && <span style={{ background:"#d1fae5", color:"#065f46", borderRadius:6, padding:"2px 8px", fontSize:11, fontWeight:700 }}>{templates[subj].items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>}
              </button>
            );
          })}
        </div>
      </div>

      {/* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ template */}
      {selSubject ? (
        <div style={{ background:"#fff", borderRadius:16, padding:24, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:20 }}>
            <h3 style={{ fontSize:15, fontWeight:700, color:"#0f2744", margin:0 }}>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î / ‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô ‚Äî {selSubject}</h3>
            <button onClick={handleDelete} style={{ background:"#fee2e2", border:"none", borderRadius:8, padding:"6px 14px", fontSize:12, cursor:"pointer", color:"#dc2626", fontFamily:"'Sarabun',sans-serif" }}>üóë ‡∏•‡∏ö‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï</button>
          </div>

          <div style={{ background:"#f8fafc", borderRadius:10, padding:"10px 14px", marginBottom:16, fontSize:13, color:"#64748b" }}>
            üí° ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          </div>

          {/* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î */}
          <div style={{ display:"flex", flexDirection:"column", gap:10, marginBottom:14 }}>
            {items.map((it, i) => (
              <div key={i} style={{ display:"flex", gap:10, alignItems:"center", background:"#f8fafc", borderRadius:10, padding:"10px 12px", border:"1px solid #e2e8f0" }}>
                <div style={{ width:24, height:24, background:"#1a56db", borderRadius:6, display:"flex", alignItems:"center", justifyContent:"center", color:"#fff", fontSize:12, fontWeight:700, flexShrink:0 }}>{i+1}</div>
                <input value={it.label} onChange={e => updateItem(i, "label", e.target.value)}
                  placeholder={`‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà ${i+1} ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô`}
                  style={{ flex:1, border:"1.5px solid #e2e8f0", borderRadius:8, padding:"8px 12px", fontSize:14, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b" }} />
                <div style={{ display:"flex", alignItems:"center", gap:6, flexShrink:0 }}>
                  <span style={{ fontSize:12, color:"#94a3b8" }}>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                  <input type="number" value={it.max} onChange={e => updateItem(i, "max", e.target.value)}
                    style={{ width:60, border:"1.5px solid #e2e8f0", borderRadius:8, padding:"8px 10px", fontSize:14, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b", textAlign:"center" }} />
                </div>
                {items.length > 1 && (
                  <button onClick={() => removeItem(i)} style={{ background:"#fee2e2", border:"none", borderRadius:7, padding:"6px 10px", fontSize:12, cursor:"pointer", color:"#dc2626", flexShrink:0, fontFamily:"'Sarabun',sans-serif" }}>‚úï</button>
                )}
              </div>
            ))}
          </div>

          <button onClick={addItem} style={{ width:"100%", background:"#f0f9ff", border:"1.5px dashed #7dd3fc", borderRadius:10, padding:"10px", color:"#0284c7", fontSize:14, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif", marginBottom:14 }}>
            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î / ‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô
          </button>

          {/* ‡∏™‡∏£‡∏∏‡∏õ + ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö */}
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12, marginBottom:14 }}>
            <div style={{ background:"#eff6ff", border:"1px solid #bfdbfe", borderRadius:10, padding:"12px 16px" }}>
              <div style={{ fontSize:12, color:"#1e40af", marginBottom:4 }}>‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö</div>
              <div style={{ fontSize:22, fontWeight:800, color:"#1a56db" }}>{totalMax} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
            </div>
            <div style={{ background:"#f0fdfa", border:"1px solid #99f6e4", borderRadius:10, padding:"12px 16px" }}>
              <div style={{ fontSize:12, color:"#065f46", marginBottom:4 }}>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
              <input type="number" value={maxExam} onChange={e => setMaxExam(e.target.value)}
                style={{ width:"100%", border:"none", background:"transparent", fontSize:22, fontWeight:800, color:"#0d9488", fontFamily:"'Sarabun',sans-serif", outline:"none" }} />
            </div>
          </div>

          <div style={{ background:"#f8fafc", border:"1px solid #e2e8f0", borderRadius:10, padding:"10px 14px", marginBottom:14, fontSize:13, color:"#374151" }}>
            ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>{totalMax + Number(maxExam)} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong> (‡πÄ‡∏Å‡πá‡∏ö {totalMax} + ‡∏™‡∏≠‡∏ö {maxExam})
          </div>

          <button onClick={handleSave}
            style={{ width:"100%", background:"linear-gradient(135deg,#1a56db,#0d9488)", border:"none", borderRadius:10, padding:13, color:"#fff", fontSize:16, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>
            {saved ? "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÅ‡∏•‡πâ‡∏ß!" : "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï"}
          </button>
        </div>
      ) : (
        <div style={{ background:"#fff", borderRadius:16, padding:40, textAlign:"center", boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
          <div style={{ fontSize:48, marginBottom:12 }}>üìã</div>
          <p style={{ color:"#94a3b8", fontSize:15 }}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î / ‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô</p>
          <p style={{ color:"#cbd5e1", fontSize:13 }}>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
        </div>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ Settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Settings({ teacherPin, setTeacherPin }) {
  const [oldPin,  setOldPin]  = useState("");
  const [newPin,  setNewPin]  = useState("");
  const [newPin2, setNewPin2] = useState("");
  const [msg,     setMsg]     = useState(null); // {type:"ok"|"err", text}

  const handleChange = () => {
    if (oldPin !== teacherPin)    { setMsg({ type:"err", text:"‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" }); return; }
    if (newPin.length < 4)        { setMsg({ type:"err", text:"‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" }); return; }
    if (newPin !== newPin2)       { setMsg({ type:"err", text:"‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô" }); return; }
    setTeacherPin(newPin);
    setOldPin(""); setNewPin(""); setNewPin2("");
    setMsg({ type:"ok", text:"‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" });
    setTimeout(() => setMsg(null), 3000);
  };

  return (
    <div style={{ maxWidth:440, margin:"0 auto" }}>
      <div style={{ background:"#fff", borderRadius:16, padding:28, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
        <h3 style={{ fontSize:16, fontWeight:700, color:"#0f2744", marginBottom:6 }}>üîê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π</h3>
        <p style={{ color:"#64748b", fontSize:13, marginBottom:20 }}>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</p>

        <Label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏î‡∏¥‡∏°</Label>
        <input type="password" value={oldPin} onChange={e => setOldPin(e.target.value)}
          placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
          style={{...inputStyle, letterSpacing:4, fontFamily:"monospace"}} />

        <Label>‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà</Label>
        <input type="password" value={newPin} onChange={e => setNewPin(e.target.value)}
          placeholder="‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)"
          style={{...inputStyle, letterSpacing:4, fontFamily:"monospace"}} />

        <Label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà</Label>
        <input type="password" value={newPin2} onChange={e => setNewPin2(e.target.value)}
          placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"
          style={{...inputStyle, borderColor: newPin2 && newPin !== newPin2 ? "#f87171" : "#e2e8f0", letterSpacing:4, fontFamily:"monospace"}} />
        {newPin2 && newPin !== newPin2 && <p style={{ color:"#f87171", fontSize:12, marginTop:-8, marginBottom:8 }}>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</p>}

        {msg && (
          <div style={{ background: msg.type==="ok" ? "#f0fdf4" : "#fef2f2", border:`1px solid ${msg.type==="ok" ? "#86efac" : "#fca5a5"}`, borderRadius:10, padding:"10px 14px", marginBottom:12, fontSize:13, fontWeight:600, color: msg.type==="ok" ? "#166534" : "#dc2626" }}>
            {msg.text}
          </div>
        )}

        <button onClick={handleChange}
          style={{ width:"100%", background:"linear-gradient(135deg,#0f2744,#1a56db)", border:"none", borderRadius:10, padding:13, color:"#fff", fontSize:16, fontWeight:700, cursor:"pointer", fontFamily:"'Sarabun',sans-serif" }}>
          ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        </button>

        <div style={{ marginTop:20, padding:"12px 16px", background:"#fffbeb", border:"1px solid #fde68a", borderRadius:10 }}>
          <p style={{ fontSize:12, color:"#92400e", margin:0 }}>‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <strong>1234</strong></p>
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Dashboard({ students, scores }) {
  const termScores = scores.filter(s => s.year === CURRENT_YEAR && s.term === CURRENT_TERM);
  const withGrade = termScores.map(s => ({
    ...s,
    total: (Number(s.collect)||0) + (Number(s.exam)||0),
    grade: calcGrade((Number(s.collect)||0) + (Number(s.exam)||0))
  }));

  const total   = withGrade.length;
  const passed  = withGrade.filter(s => s.grade !== "0").length;
  const failed  = total - passed;
  const avgScore = total ? (withGrade.reduce((a,b) => a + b.total, 0) / total).toFixed(1) : "-";
  const passRate = total ? ((passed/total)*100).toFixed(1) : "-";

  const gradeCount = {};
  ["0","1","1.5","2","2.5","3","3.5","4"].forEach(g => gradeCount[g] = withGrade.filter(s => s.grade === g).length);

  // by subject
  const subjectStats = {};
  withGrade.forEach(s => {
    if (!subjectStats[s.subject]) subjectStats[s.subject] = { total:0, pass:0, scores:[] };
    subjectStats[s.subject].total++;
    if (s.grade !== "0") subjectStats[s.subject].pass++;
    subjectStats[s.subject].scores.push(s.total);
  });

  return (
    <div>
      {/* Summary cards */}
      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:14, marginBottom:20 }}>
        {[
          { label:"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", value:total, color:"#1a56db", bg:"#eff6ff" },
          { label:"‡∏ú‡πà‡∏≤‡∏ô", value:passed, color:"#16a34a", bg:"#f0fdf4" },
          { label:"‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô", value:failed, color:"#dc2626", bg:"#fef2f2" },
          { label:"‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏ú‡πà‡∏≤‡∏ô", value: passRate === "-" ? "-" : `${passRate}%`, color:"#0d9488", bg:"#f0fdfa" },
        ].map((c,i) => (
          <div key={i} style={{ background:c.bg, borderRadius:14, padding:"16px 18px", border:`1.5px solid ${c.color}30` }}>
            <div style={{ fontSize:13, color:"#64748b", marginBottom:6 }}>{c.label}</div>
            <div style={{ fontSize:28, fontWeight:800, color:c.color }}>{c.value}</div>
          </div>
        ))}
      </div>

      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16 }}>
        {/* Grade distribution */}
        <div style={{ background:"#fff", borderRadius:16, padding:20, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
          <h3 style={{ fontSize:15, fontWeight:700, color:"#0f2744", marginBottom:16 }}>üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏Å‡∏£‡∏î</h3>
          <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
            {["4","3.5","3","2.5","2","1.5","1","0"].map(g => {
              const cnt = gradeCount[g] || 0;
              const gc = gradeColor(g);
              const pct = total > 0 ? (cnt/total*100) : 0;
              return (
                <div key={g} style={{ display:"flex", alignItems:"center", gap:10 }}>
                  <span style={{ width:32, fontSize:14, fontWeight:700, color:gc.text, textAlign:"right" }}>{g}</span>
                  <div style={{ flex:1, background:"#f1f5f9", borderRadius:4, height:20, overflow:"hidden" }}>
                    <div style={{ height:"100%", width:`${pct}%`, background:gc.text, borderRadius:4, minWidth: cnt > 0 ? 4 : 0, transition:"width 0.5s" }} />
                  </div>
                  <span style={{ width:28, fontSize:13, color:"#64748b", textAlign:"right" }}>{cnt}</span>
                </div>
              );
            })}
          </div>
          <div style={{ marginTop:16, padding:"10px 14px", background:"#f8fafc", borderRadius:10, textAlign:"center" }}>
            <span style={{ fontSize:13, color:"#64748b" }}>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: </span>
            <span style={{ fontSize:18, fontWeight:800, color:"#1a56db" }}>{avgScore}</span>
          </div>
        </div>

        {/* By subject */}
        <div style={{ background:"#fff", borderRadius:16, padding:20, boxShadow:"0 2px 12px rgba(0,0,0,0.06)" }}>
          <h3 style={{ fontSize:15, fontWeight:700, color:"#0f2744", marginBottom:16 }}>üìö ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤</h3>
          {Object.keys(subjectStats).length === 0 ? (
            <p style={{ color:"#94a3b8", textAlign:"center", padding:20 }}>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
          ) : (
            <div style={{ display:"flex", flexDirection:"column", gap:8, maxHeight:300, overflowY:"auto" }}>
              {Object.entries(subjectStats).map(([subj, stat]) => {
                const avg = stat.scores.length ? (stat.scores.reduce((a,b)=>a+b,0)/stat.scores.length).toFixed(1) : "-";
                const rate = stat.total ? ((stat.pass/stat.total)*100).toFixed(0) : "-";
                return (
                  <div key={subj} style={{ background:"#f8fafc", borderRadius:10, padding:"10px 14px", border:"1px solid #e2e8f0" }}>
                    <div style={{ fontSize:13, fontWeight:700, color:"#1e293b", marginBottom:5 }}>{subj}</div>
                    <div style={{ display:"flex", gap:16, fontSize:12, color:"#64748b" }}>
                      <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {stat.total} ‡∏Ñ‡∏ô</span>
                      <span style={{ color:"#16a34a" }}>‡∏ú‡πà‡∏≤‡∏ô {rate}%</span>
                      <span style={{ color:"#1a56db" }}>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ {avg}</span>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const inputStyle  = { width:"100%", border:"1.5px solid #e2e8f0", borderRadius:9, padding:"10px 13px", fontSize:15, fontFamily:"'Sarabun',sans-serif", outline:"none", color:"#1e293b", marginBottom:12, display:"block" };
const selectStyle = { ...inputStyle, background:"#fff", cursor:"pointer" };
function Label({ children }) {
  return <label style={{ display:"block", fontSize:13, fontWeight:600, color:"#374151", marginBottom:5 }}>{children}</label>;
}


    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>